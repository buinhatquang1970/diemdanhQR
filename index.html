<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chào mừng Đại hội Đảng Bộ Cục Tần số vô tuyến điện lần thứ V, nhiệm kỳ 2025-2030</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    #attendanceForm {
      display: flex;
      align-items: center;
      gap: 24px;
      flex-wrap: wrap;
    }
    .form-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    label {
      font-size: 18px;
      min-width: 90px;
      text-align: right;
      margin-bottom: 0;
      margin-top: 0;
    }
    select, button {
      font-size: 18px;
      height: 44px;
      min-width: 180px;
      padding: 2px 8px;
      margin-top: 0;
      margin-bottom: 0;
    }
    button {
      min-width: 120px;
      cursor: pointer;
    }
    #message { margin-top:20px; color:green; font-weight:bold; }
    @media (max-width: 900px) {
      #attendanceForm { flex-direction: column; align-items: flex-start; gap: 12px;}
      .form-row { width: 100%; }
      button { width: 100%; }
    }
  </style>
</head>
<body>
  <div style="text-align:center; margin-top: 10px;">
    <img src="logo_CTS.jpg" alt="Logo ARFM" style="max-height: 100px;">
  </div>
  <h2>Chào mừng Đại hội Đảng Bộ Cục Tần số vô tuyến điện lần thứ V, nhiệm kỳ 2025-2030</h2>
  <form id="attendanceForm">
    <div class="form-row">
      <label for="chibo">Chi bộ:</label>
      <select name="chibo" id="chibo" required>
        <option value="">-- Chọn chi bộ --</option>
      </select>
    </div>
    <div class="form-row">
      <label for="dangvien">Đảng viên:</label>
      <select name="dangvien" id="dangvien" required>
        <option value="">-- Chọn đảng viên --</option>
      </select>
    </div>
    <input type="hidden" name="latitude" id="latitude">
    <input type="hidden" name="longitude" id="longitude">
    <button type="submit" id="submitBtn" disabled>Điểm danh</button>
  </form>
   <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
       
    </p>
  <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
            
 </p>
  <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
   Lưu ý:  .
 </p>
  <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
   1. Phải bật GPS lên và cho phép truy cập vị trí (nếu được hỏi) mới điểm danh được
 </p>
 <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
   2. Hướng dẫn người dùng bật định vị cho trình duyệt
</p>
<p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
  Vào Cài đặt > Quyền riêng tư > Dịch vụ định vị > Bật
 </p>
 <p style="text-align:left; font-style: bold; margin-top: -10px; margin-bottom: 12px; font-size: 16px;">
  Vào Cài đặt > Safari > Vị trí > Cho phép truy cập (đối với Iphone)
 </p>
  <div id="message"></div>

  <script>
    // Danh sách chi bộ và đảng viên (đã tổng hợp từ dữ liệu bạn gửi)
    const data = {
      "Chi bộ Văn phòng": [
        "ĐẶNG THỊ THIÊN HẰNG","NGUYỄN QUỐC KHÁNH","TRẦN THỊ THANH THUỶ","NGUYỄN XUÂN PHONG","TỪ THỊ THU TRANG","TRẦN VĂN HIỀN","HOÀNG HỒNG ANH","LÊ VĂN VIỆT"
      ],
      "Chi bộ ADCP": [
        "NGUYỄN THỊ QUỲNH MAI","NGUYỄN THỊ MINH HƯỜNG","PHẠM HOÀNG LÊ","VŨ THANH HÒA"
      ],
      "Chi bộ CSQH-HTQT": [
        "LÊ THÁI HÒA","NGUYỄN TIẾN HẢI","NGUYỄN HUY CƯƠNG","VŨ THU HIỀN","NGUYỄN HỒNG TUẤN","NGUYỄN THANH THỦY","NGÔ THANH HƯƠNG","NGUYỄN THỊ THU HUYỀN","LƯƠNG XUÂN TRƯỜNG","HỒ QUANG SƠN","LƯU THỊ VIỆT NGA","NGUYỄN DUY HIẾU","HOÀNG LÊ TRUNG","BÙI HÀ LONG","VĂN THỊ HOÀNG NGÂN"
      ],
      "Chi bộ TCCB": [
        "LÊ VĂN TUẤN","NGUYỄN TRUNG THÀNH","MAI THANH THỦY","TRỊNH KHẮC CƯỜNG","HÀ THỊ VIỆT ANH","NGUYỄN VŨ TRÀ MY","TRẦN THỊ THANH THỦY","HÀ HOÀNG QUYÊN"
      ],
      "Chi bộ KHTC": [
        "NGUYỄN PHƯƠNG ANH","NGUYỄN TUẤN ANH","ĐOÀN TUYẾT LAN","NGUYỄN HẢI BÌNH","ĐỖ HƯNG HÀ","TÔ VIỆT DŨNG","NGUYỄN BÁ TRUNG","LƯU THỊ THU TRANG","LƯƠNG THÚY OANH","ĐẶNG THỊ THANH TÂM","TRẦN THỊ NGỌC LAN"
      ],
      "Chi bộ TTKT": [
        "NGUYỄN PHƯƠNG ĐÔNG","NGUYỄN VĂN KHANH","TRẦN XUÂN THIỆN","BÙI NHẬT QUANG","HÀ THỊ KIM THOA","NGUYỄN HỒNG HẢI","NGUYỄN KHẮC HUỲNH","CHU QUANG THÀNH","LỮ VĂN THẮNG","DƯƠNG HOÀNG GIANG","NGUYỄN THỊ THU HUYỀN","NGUYỄN ĐÌNH TUYỂN","NGUYỄN ĐÌNH TUẤN","LÊ HỒNG LINH","NGUYỄN TIỀN PHONG","BÙI THỊ MINH HÀ","NGUYỄN NGỌC NAM","HỒ KHÁNH TOÀN","PHAN TRUNG KIÊN"
      ],
      "Chi bộ Thanh tra -KSTS": [
        "TRẦN MẠNH TUẤN","PHÙNG NGUYÊN PHƯƠNG","NGUYỄN TRỌNG QUANG","VŨ QUỐC KHÁNH","VÕ GIANG NAM","TRỊNH THỊ HỒNG LIÊN","ĐẶNG TIẾN NGUYÊN","HỒ VIẾT THẮNG","LÊ VĂN TUYÊN","TRƯƠNG MINH TUẤN","LÊ BÌNH THỊ THÙY DƯƠNG","VŨ SƠN TÙNG","DƯƠNG ĐỨC TIẾN"
      ],
      "Chi bộ TT1": [
        "AN XUÂN HẢI","ĐẶNG THỊ PHONG THUỶ","NGUYỄN XUÂN MINH","TRỊNH SƠN TÙNG","NGUYỄN MẠNH HẢI","HOÀNG LONG","NGUYỄN ANH SƠN","ĐOÀN MINH TRANG","HOÀNG VIỆT","NGUYỄN NGỌC ANH","NGUYỄN ĐỨC HUẤN","TÔ THỊ HƯỜNG","NGUYỄN VIỆT HÙNG","NGÔ NHẤT SƠN","ĐẬU VIẾT CƯỜNG","VŨ HÀM LONG","NGUYỄN TRƯỜNG MINH","TRẦN HẢI NINH","NGUYỄN QUANG ĐẠO","VŨ NGỌC HƯNG"
      ],
      "Chi bộ TT2": [
        "NGUYỄN THIỆN QUÝ","NGUYỄN CẢNH THẾ","LÂM ĐẠO TÂM","TRẦN XUÂN THẮNG","HỒ LÊ TÙNG","VŨ THỊ THANH THÙY","LÊ ĐỨC HẠNH","VÕ HOÀI PHONG","PHẠM QUỐC HƯNG","PHẠM ĐÌNH DIỆU"
      ],
      "Chi bộ TT3": [
        "PHAN THỊ THU HƯƠNG","NGUYỄN PHÚ HÀ","TRƯƠNG CÔNG HẠNH","NGUYỄN HUY THẮNG","NGUYỄN VĂN HẢI","NGUYỄN NHO TỬU","ĐINH TẤN ĐỨC","NGUYỄN THANH HÀ","DƯƠNG TIẾN DŨNG","LÊ QUANG TRƯỜNG","NGUYỄN THỊ HỒNG THỦY","TẠ THỊ HÀ CHUNG","NGUYỄN ĐỨC KHOA","LÊ VĂN NGỌC","NGUYỄN THẾ HIỂN","CHU MẠNH CƯỜNG","NGUYỄN MẠNH TUẤN","HOÀNG ANH TÚ"
      ],
      "Chi bộ TT4": [
        "HUỲNH PHƯƠNG CHÂU","LÊ BÌNH HOÀ","TRẦN CÔNG KHẢ","PHAN HOÀNG LÃM","NGUYỄN HUỲNH PHONG SƠN","PHAN THANH THẢO","NGUYỄN VĂN NGỌC VỮNG","LÊ PHÚ SỸ TIÊN","NGÔ QUỐC DỄ","ĐỖ THỊ HUYỀN"
      ],
      "Chi bộ TT5": [
        "BÙI ĐỨC TOẢN","NGUYỄN THỊ HẰNG","VŨ TRÍ HẢI","NGUYỄN THỊ THANH NGA","ĐÀO VĂN ĐỨC","TRẦN ĐÌNH TUÂN","ĐOÀN LÊ VĂN","NGUYỄN HỒNG NHẬT","VŨ ĐÌNH TÚ","NGUYỄN TUẤN SƠN","NGUYỄN THỊ THANH VÂN"
      ],
      "Chi bộ TT6": [
        "ĐỖ ĐÌNH ROANH","HỒ VIỆT NAM","NGUYỄN ANH TUẤN","PHAN VĂN  HẢI","LÊ SONG HÀO","TRẦN QUỐC DŨNG","LẠI QUỐC THUẬT","NGUYỄN THỊ THÚY","NGUYỄN VĂN KHÁNH","ĐINH THỊ TUYẾT MINH","NGUYỄN THỊ DƯƠNG LIỄU","TRẦN QUỐC BẢO","ĐẶNG KHẮC VĨNH","THÁI TRỌNG HIỀN","NGUYỄN XUÂN PHÚC","NGUYỄN TUẤN ANH","NGUYỄN ĐÌNH CHƯƠNG"
      ],
      "Chi bộ TT7": [
        "LÊ HOÀNG NGUYÊN","NGUYỄN MINH ĐỒNG","ĐẶNG HOÀI NAM","NGUYỄN THỊ LỆ TÚ","NGUYỄN THANH SƠN","LÊ THANH HẢI","TRẦN THANH HẢI","TRƯƠNG QUỐC BẢO","NGUYỄN TUẤN NGỌC","NGUYỄN VĂN HIỆU","NGUYỄN ĐÌNH TUẤN","PHẠM QUANG HƯNG","PHAN THẾ TUỆ","ĐỖ THỊ PHƯƠNG ANH"
      ],
      "Chi bộ TT8": [
        "PHAN THANH QUANG","NGUYỄN HẢI ANH","NGÔ MINH TRÍ","TRẦN XUÂN SƠN","HOÀNG ĐỨC CƯỜNG","ĐỖ QUANG HƯNG","MAI THỊ THU HIỀN","CAO THÀNH HIẾU","VŨ LÊ HẢI"
      ]
    };

    // Sinh danh sách chi bộ
    const chiboEl = document.getElementById('chibo');
    Object.keys(data).forEach(chibo => {
      chiboEl.innerHTML += `<option value="${chibo}">${chibo}</option>`;
    });

    // Khi đổi chi bộ, đổi danh sách đảng viên
    chiboEl.addEventListener('change', function() {
      const dvEl = document.getElementById('dangvien');
      dvEl.innerHTML = `<option value="">-- Chọn đảng viên --</option>`;
      const dangviens = data[this.value] || [];
      dangviens.forEach(dv => {
        dvEl.innerHTML += `<option value="${dv}">${dv}</option>`;
      });
    });

    // Disable nút submit cho đến khi GPS sẵn sàng
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.disabled = false;

    // Lấy GPS tự động, chỉ enable nút submit khi có tọa độ
    function enableSubmitIfReady() {
      const lat = document.getElementById('latitude').value;
      const lon = document.getElementById('longitude').value;
      if (lat && lon) {
        submitBtn.disabled = false;
      }
    }

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(function(position) {
        document.getElementById('latitude').value = position.coords.latitude;
        document.getElementById('longitude').value = position.coords.longitude;
        enableSubmitIfReady();
      }, function() {
        document.getElementById('message').textContent = "Bạn cần bật GPS để điểm danh!";
      });
    } else {
      document.getElementById('message').textContent = "Trình duyệt không hỗ trợ GPS!";
    }

    // Gửi dữ liệu lên Google Apps Script
    document.getElementById('attendanceForm').onsubmit = function(e){
      e.preventDefault();
      const lat = document.getElementById('latitude').value;
      const lon = document.getElementById('longitude').value;
      if (!lat || !lon) {
        document.getElementById('message').textContent = "Không thể lấy vị trí GPS! Vui lòng nhấn F5 để thử lại.";
        return;
      }
      document.getElementById('message').textContent = "Please wait..."; // Hiện thông báo ngay khi gửi
      var dataForm = new FormData(this);
      fetch('https://script.google.com/macros/s/AKfycbyn1aB0Dd8Yc-_g1rlz7zV36TAEKSWARgoyU8sznioEmKxAGQZUXOh0vJfurPFEMbCvuw/exec', {
        method: 'POST',
        body: dataForm
      })
      .then(response => response.text())
      .then(msg => {
        document.getElementById('message').textContent = msg;
        document.getElementById('attendanceForm').reset();
        // Sau khi reset cần disable lại nút submit cho đến khi lấy lại GPS
       
      })
      .catch(() => {
        document.getElementById('message').textContent = "Gửi dữ liệu thất bại!";
      });
    }
  </script>
</body>
</html>